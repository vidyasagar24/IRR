<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IRR Calculator</title>

<style>
body{
    font-family: Arial, sans-serif;
    background: linear-gradient(to right,#4facfe,#00f2fe);
    margin:0;
    padding:0;
}

.container{
    max-width:800px;
    background:white;
    margin:30px auto;
    padding:20px;
    border-radius:12px;
    box-shadow:0 10px 25px rgba(0,0,0,0.2);
}

h1{
    text-align:center;
}

.grid{
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:12px;
    margin-top:15px;
    max-height:420px;
    overflow-y:auto;
    padding:5px;
}

.flow-box{
    display:flex;
    flex-direction:column;
    text-align:center;
}

.flow-box label{
    font-size:13px;
    color:#555;
    margin-bottom:4px;
}

.flow-box input{
    padding:8px;
    border-radius:6px;
    border:1px solid #ccc;
    font-size:14px;
}

.buttons{
    text-align:center;
    margin-top:18px;
}

button{
    padding:10px 18px;
    margin:5px;
    border:none;
    border-radius:6px;
    font-size:15px;
    cursor:pointer;
}

.add-btn{
    background:#4CAF50;
    color:white;
}

.calc-btn{
    background:#2196F3;
    color:white;
}

.clear-btn{
    background:#f44336;
    color:white;
}

.result{
    margin-top:15px;
    text-align:center;
    font-size:20px;
    font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

<h1>IRR Calculator</h1>

<div id="cashGrid" class="grid"></div>

<div class="buttons">
<button class="add-btn" onclick="addRow()">Add More Cash Flows</button>
<button class="calc-btn" onclick="calculateIRR()">Calculate IRR</button>
<button class="clear-btn" onclick="clearAll()">Clear</button>
</div>

<div class="result" id="result"></div>

</div>

<script>

let yearCount = 0;
const DEFAULT_FLOWS = 40;

// Add single cash flow input
function addCashInput(){
    yearCount++;

    let grid = document.getElementById("cashGrid");

    let box = document.createElement("div");
    box.className = "flow-box";

    box.innerHTML = `
        <label>Year ${yearCount}</label>
        <input type="number" placeholder="Cash Flow">
    `;

    grid.appendChild(box);
}

// Load 40 default inputs
function loadDefault(){
    for(let i=0;i<DEFAULT_FLOWS;i++){
        addCashInput();
    }
}

// Add more (4 at a time)
function addRow(){
    for(let i=0;i<4;i++){
        addCashInput();
    }
}

function clearAll(){
    document.getElementById("cashGrid").innerHTML="";
    document.getElementById("result").innerHTML="";
    yearCount=0;
    loadDefault();
}

function getCashFlows(){
    let inputs = document.querySelectorAll("#cashGrid input");
    let flows = [];

    inputs.forEach(input=>{
        if(input.value !== ""){
            flows.push(parseFloat(input.value));
        }
    });

    return flows;
}

function calculateIRR(){

    let cashFlows = getCashFlows();

    if(cashFlows.length < 2){
        alert("Enter at least two cash flows!");
        return;
    }

    let irr = IRR(cashFlows);

    if(isNaN(irr) || !isFinite(irr)){
        document.getElementById("result").innerHTML = "IRR cannot be calculated";
    }
    else{
        document.getElementById("result").innerHTML = 
        "IRR = " + (irr*100).toFixed(2) + " %";
    }
}

function IRR(values){

    let guess = 0.1;
    let tol = 0.000001;

    for(let i=0;i<1000;i++){

        let f = 0;
        let df = 0;

        for(let t=0;t<values.length;t++){
            f += values[t]/Math.pow(1+guess,t);
            df += -t*values[t]/Math.pow(1+guess,t+1);
        }

        let newGuess = guess - f/df;

        if(Math.abs(newGuess-guess) < tol){
            return newGuess;
        }

        guess = newGuess;
    }

    return NaN;
}

// Load default 40 inputs on page load
loadDefault();

</script>

</body>
</html>
